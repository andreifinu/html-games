<!DOCTYPE html>
<html>
<head>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        #game-board {
            position: relative;
            height: 400px;
            width: 400px;
            border: 1px solid black;
        }
        .dot {
            position: absolute;
            height: 20px;
            width: 20px;
            background-color: #000;
        }
        .apple {
            position: absolute;
            height: 20px;
            width: 20px;
            background-color: #f00;
            border-radius: 50%;
        }
    </style>
</head>
<body>
    <div id="game-board"></div>
    <p id="score">Score: 0</p>
    <script>
        var dotSize = 20;
        var gameBoardSize = 400;
        var direction = 'right';
        var snake = [{ top: 0, left: 0 }];
        var apple = null;
        var score = 0;

        function updateGameBoard() {
            var gameBoard = document.getElementById('game-board');

            // clear previous state
            while (gameBoard.firstChild) {
                gameBoard.firstChild.remove();
            }

            // draw snake
            snake.forEach(function(dot) {
                var dotElement = document.createElement('div');
                dotElement.className = 'dot';
                dotElement.style.top = `${dot.top}px`;
                dotElement.style.left = `${dot.left}px`;
                gameBoard.appendChild(dotElement);
            });

            // draw apple
            if (apple == null) {
                apple = { top: Math.floor(Math.random() * gameBoardSize / dotSize) * dotSize, left: Math.floor(Math.random() * gameBoardSize / dotSize) * dotSize };
            }
            
            var appleElement = document.createElement('div');
            appleElement.className = 'apple';
            appleElement.style.top = `${apple.top}px`;
            appleElement.style.left = `${apple.left}px`;
            gameBoard.appendChild(appleElement);

            // check for collisions
            if (snake.find(function(dot, index){
                return index != 0 && dot.top == snake[0].top && dot.left == snake[0].left;
            })) {
                snake = [{ top: 0, left: 0 }];
                direction = 'right';
                apple = null;
                score = 0;
                document.getElementById('score').innerText = "Score: " + score;
                return;
            }

            // check for apple collision
            if (snake[0].top == apple.top && snake[0].left == apple.left) {
                apple = null;
                score++;
                document.getElementById('score').innerText = "Score: " + score;

                var lastDot = Object.assign({}, snake[snake.length - 1]);
                switch(direction) {
                    case 'left':
                        lastDot.left -= dotSize;
                        break;
                    case 'up':
                        lastDot.top -= dotSize;
                        break;
                    case 'right':
                        lastDot.left += dotSize;
                        break;
                    case 'down':
                        lastDot.top += dotSize;
                        break;  
                }
                snake.push(lastDot);
            }
        }

        function updateSnake() {
          var head = Object.assign({}, snake[0]); // copy head
          switch(direction) {
              case 'left':
                  head.left -= dotSize;
                  break;
              case 'up':
                  head.top -= dotSize;
                  break;
              case 'right':
                  head.left += dotSize;
                  break;
              case 'down':
                  head.top += dotSize;
                  break;  
          }

          // wrap around screen boundaries
          if (head.top < 0) head.top = gameBoardSize - dotSize; 
          else if (head.left < 0) head.left = gameBoardSize - dotSize; 
          else if (head.top === gameBoardSize) head.top = 0; 
          else if (head.left === gameBoardSize) head.left = 0;

          snake.unshift(head); // add new head to snake
          snake.pop(); // remove tail
      }

      function handleKey(e) {
          e = e || window.event;

          if (e.keyCode == '38' && direction != 'down') {
              direction = 'up';
          } else if (e.keyCode == '40' && direction != 'up') {
              direction = 'down';
          } else if (e.keyCode == '37' && direction != 'right') {
             direction = 'left';
          } else if (e.keyCode == '39' && direction != 'left') {
             direction = 'right';
          }
      }

      document.onkeydown = handleKey;

      setInterval(function() {
          updateSnake();
          updateGameBoard();
      }, 200);
    </script>
</body>
</html>
